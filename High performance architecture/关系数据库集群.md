
**高性能数据库集群的第一种方式是“读写分离”，其本质是将访问压力分散到集群中的多个节点，但是没有分散存储压力；第二种方式是“分库分表飞既可以分散访问压力，又可以分散存储压力。读写分离需要将读／写操作区分开来，然后访问不同的数据库服务器； 分库分表需要根据不同的数据访问不同的数据库服务器，两者本质上都是一种分配机制，即将不同的SQL 语句发送到不同的数据库服务器**


* [读写分离](#读写分离)
* [分库分表](#分库分表)
  * 业务分库
  * 分表
* [关系数据库高性能存储的实现方式](#关系数据库高性能存储的实现方式)
  * 程序代码封装
  * 中间件封装


## 读写分离

  读写分离的基本原理是将数据库读写操作分散到不同的节点上,读写分离的基本实现如下：
  
      (1）数据库服务器搭建主从集群， 一主一从、一主多从都可以。
      
      (2）数据库主机负责读写操作，从机只负责读操作。
      
      (3）数据库主机通过复制将数据同步到从机，每台数据库服务器都存储了所有的业务数据。
      
      (4）业务服务器将写操作发给数据库主机，将读操作发给数据库从机。

  **读写分离的复杂度：**
  
     读写分离的实现逻辑并不复杂，但在实际应用过程中需要应对复制延迟带来的复杂性。
     
     正确解决读写分离复制延迟的方法：
     
         (1）写操作后的读操作指定发给数据库主服务器。
         
             例如，注册账号完成后， 登录时读取账号的读操作也发给数据库主服务器。这种方式和业务强绑定，对业务的侵入和影响较大，如果哪个新来的程序
             员不知道这样写代码，就会导致一个bug 。
         
         (2）读从机失败后再读一次主机。
         
             这就是通常所说的“二次读取”，二次读取和业务无绑定，只需要对底层数据库访问的API，进行封装即可， 实现代价较小， 不足之处在于如果有很多二
             次读取，将大大增加主机的读操作压力。例如， 黑客暴力破解账号， 会导致大量的二次读取操作，主机可能顶不住读操作的压力从而崩愤。
         
         (3）关键业务读写操作全部指向主机，非关键业务采用读写分离。
         
             例如，对于一个用户管理系统来说，注册＋登录的业务读写操作全部访问主机， 用户的介绍、爱好、等级等业务，可以采用读写分离，因为即使用户改
             了自己的自我介绍，在查询时却看到了自我介绍还是旧的，业务影响与不能登录相比就小很多，还可以忍受。

## 分库分表


# 关系数据库高性能存储的实现方式

**读写分离需要将读／写操作区分开来，然后访问不同的数据库服务器； 分库分表需要根据不同的数据访问不同的数据库服务器，两者本质上都是一种分配机制，即将不同的SQL 语句发送到不同的数据库服务器**

## 程序代码封装

   **程序代码封装指在代码中抽象一个数据访问层来实现读写分离、分库分表**

   目前开源的实现方案中，淘宝的TDDL ( Taobao Di s tributed Data L ayer ， 外号： 头都大了）是比较有名的。它是一个通用数据访问层，所有功能封装在j a r 包中供业务代码调用。其基本原理是一个基于集中式配置的jdbc datasource 实现，具有主备、读写分离、动态数据库配置等功能

## 中间件封装

   **中间件封装指的是独立一套系统出来，实现读写分离和分库分表操作**，中间件对业务服务器提供SQL 兼容的协议，对于业务服务器来说，访问中间件和访问数
     据库没有区别， 事实上在业务服务器看来，中间件就是一个数据库服务器。
   
   **数据库中间件的方式具备如下特点**：
   
     • 能够支持多种编程语言，因为数据库中间件对业务服务器提供的是标准SQL 接口。
   
     • 数据库中间件要支持完整的SQL 语法和数据库服务器的协议（例如， MySQL 客户端和服务器的连接协议），这是一个很复杂的事情，而且细节特别多，很容易
       出现bug
     
     • 数据库中间件自己不执行真正的读写操作，但所有的数据库操作请求都要经过中间件，中间件的性能要求也很高。

     • 数据库主从切换对业务服务器无感知， 数据库中间件可以探测数据库服务器的主从状态。例如，向某个测试表写入－ 条数据，成功的就是主机，失败的就
       是从机。
   
   
   
